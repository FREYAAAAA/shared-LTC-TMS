<!DOCTYPE html>
<html lang="en">
<head>
<title>Schedule</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://www.gstatic.com/firebasejs/5.4.1/firebase.js"></script>
<script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
<link rel="stylesheet" href="SCHEDULE.css">

</head>

<body bgcolor= "#ddd">
<img  style="position:absolute;Right:35px;top:45px;font-size:12px;color:blue"  alt='CNO/Director' >

<div class="topnav">
<div class="dropdown">
  <button class="dropbtn">Schedule</button>
  <div class="dropdown-content">
    <a href="#">Schedule</a>
    <a href="#">Memo</a>
    <a href="#">Task Editor</a>
    <a href="#">Library</a>
    <a href="#">E-portfolio</a>
  </div>
</div>
</div>

<div class="content">

</div>
<div style="position:absolute;Right:30px;top:15px;">
<select>
    <option value="English">English</option>
    <option value="Chinese">Chinese</option>
</select>
<button id='btnLogout'>Logout</button>
</div>

<div style="position:absolute;Right:370px;top:250px;">
<table>
    <tr>
        <th> Working Schedule </th>
        <td style="background-color: #3a6070"> <button type="button"><img src="image\add.png" height="15px" width="15px"/></button> </td>
        <td style="background-color: #3a6070"> <button type="button"><img src="image\down-arrow.png" height="15px" width="15px"/></button> </td>
    </tr>
    <tr>
        <td style="border: 1.5px solid #000"> April Working Schedule.pdf </td>
        <td> <button type="button"><img src="image\trash-can.png" height="15px" width="15px"/></button> </td>
    </tr>
    <tr>
        <td style="border: 1.5px solid #000"> May Working Schedule.pdf </td>
        <td> <button type="button"><img src="image\trash-can.png" height="15px" width="15px"/></button> </td>
    </tr>
</table>
</div>

<div style="position:absolute;Right:250px;top:50px;">
<table id='eventTable'>
    <tr>
      <td>ID</td>
      <td>Date of Event</td>
      <th> Event </th>

      <td style="background-color: #3a6070"> <button type="button" onclick="AddNewEvent()"><img src="image\add.png" height="15px" width="15px"/></button> </td>
      <td style="background-color: #3a6070"> <button type="button"><img src="image\down-arrow.png" height="15px" width="15px"/></button> </td>
    </tr>
<!--    <tr>
      <td></td>

      <td><input id="EventTime" type="text" name="EventDate"></td>
      <td><input id="EventActivity"type="text" name="EventName" ></td><td> <button type="button" onclick="createNewEvent()">Enter</button> </td>
    </tr>-->
</table>
</div>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>

<div style="position:absolute;Right:400px;top:400px;">
<table>
    <tr>
        <th> Working Hour </th>
        <td style="background-color: #3a6070"> <button type="button"><img src="image\add.png" height="15px" width="15px"/></button> </td>
        <td style="background-color: #3a6070"> <button type="button"><img src="image\down-arrow.png" height="15px" width="15px"/></button> </td>


    </tr>
    <tr>
        <td style="border: 1.5px solid #000"> April Working Hour.pdf </td>
        <td> <button type="button"><img src="image\trash-can.png" height="15px" width="15px"/></button> </td>
    </tr>
    <tr>
        <td style="border: 1.5px solid #000"> May Working Hour.pdf </td>
        <td> <button type="button"><img src="image\trash-can.png" height="15px" width="15px"/></button> </td>
    </tr>
</table>
</div>



<div style="position:absolute;Right:950px;top:50px;">
<table id="table">
  <thread>
    <tr>
        <td>ID</td>
        <th>Announcement</th>
        <td style="background-color: #3a6070"> <button id ="btnAdd" class="btn btn-action" type="button" onclick="AddNewA()"><img src="image\add.png" height="15px" width="15px"/></button> </td>
        <td style="background-color: #3a6070"> <button id ="btnDrop" type="button"><img src="image\down-arrow.png" height="15px" width="15px"/></button> </td>

    </tr>
  </thread>
  <tbody>


  </tbody>
<!--  <tr>
    <td></td>
    <td>
      <textarea id="Announcement" type=text rows="4" cols="30"></textarea></td>
        <td><button id="btnSubmitA" >Enter</button></td>
    </tr>-->
</table>

<div id="newABlock">
<div id="PopupEditBox">
  <div id="editForm">
    <h2>New Announcement</h2>
    <hr>
    Announcement:
    <textarea id="Announcement" type=text rows="4" cols="30" placeholder="Text Here..."></textarea>
    <button id="btnSubmitE" onclick="createNewAnnouncement()">Sumbit</button>
    <button id="Ecancel" onclick="editCancel()">Cancel</button>
  </div>
</div>
</div>

<div id="editABlock">
<div id="PopupEditBox">
  <div id="editForm">
    <h2>Editing Announcement</h2>
    <hr>
    Announcement ID:
    <input type=text id="announcement_id"> </input>
    Announcement:
    <textarea id="Amsg"></textarea>
    <button id="Esave" onclick="editSave()">Save</button>
    <button id="Ecancel" onclick="editCancel()">Cancel</button>
  </div>
</div>
</div>

<div id="editEBlock">
<div id="PopupEditBox">
  <div id="editForm">
    <h2>Edit Event</h2>
    <hr>
    EID:
    <input id="Ekey"></input>
    Date of Event:
    <input id="DoE" type=text></input>
    Event:
    <input id="Event" type= text></input>
    <button id="btnSubmitE" onclick="editEsave()">Save</button>
    <button id="Ecancel" onclick="editCancel()">Cancel</button>
  </div>
</div>
</div>

<div id="newEBlock">
<div id="PopupEditBox">
  <div id="editForm">
    <h2>Edit Event</h2>
    <hr>
    Date of Event:
    <input id="EventTime" type=text></input>
    Event:
    <input id="EventActivity" type= text></input>
    <button id="btnSubmitE" onclick="createNewEvent()">Sumbit</button>
    <button id="Ecancel" onclick="editCancel()">Cancel</button>
  </div>
</div>
</div>

<script>
// Initialize Firebase
  var config = {
    apiKey: "AIzaSyCnuAZzFvkT-FSRxB5Vk67JM6FU9wZLYMQ",
    authDomain: "share-b7589.firebaseapp.com",
    databaseURL: "https://share-b7589.firebaseio.com",
    projectId: "share-b7589",
    storageBucket: "share-b7589.appspot.com",
    messagingSenderId: "323469467975"
  };
  firebase.initializeApp(config);

  var btnLogout = document.getElementById('btnLogout')
  btnLogout.addEventListener('click', e => {
    firebase.auth().signOut();
  });
  //Create new Announcement button
  function AddNewA(){
      document.getElementById('newABlock').style.display ='block';
  }

  //Read firebase Announcements
  var fbA = firebase.database().ref('Announcements');
  /*fbA.on("child_added", snap =>{
    var Textarea = snap.child("Announcement").val();
    var aid = snap.child("a_id").val();

    $("#table").append("<tr><td>" + aid + "</td><td>" + Textarea + '</td><td> <button type="button" onclick="editA()"><img src="image/pencil.png" height="15px" width="15px"/></button></td><td><button id="delete" onclick="deleteA()" type="button"><img src="image/trash-can.png" height="15px" width="15px"/></button> </td></tr>');

  });*/
  var Atable = document.getElementById('table')
  var rowIndex = 1;
  //Sending data to firebase db
  fbA.once('value',function(snapshot){
    snapshot.forEach(function(childSnapshot){
      var childKey = childSnapshot.key;
      var childData = childSnapshot.val();
      var button = document.createElement("button");
      var button2 = document.createElement("button");
      button.innerHTML="Edit";
      button2.innerHTML="Delete";

      var row = Atable.insertRow(rowIndex);
      var cellId = row.insertCell(0)
      var cellAnnouncement= row.insertCell(1);
      var cellButton= row.insertCell(2)
      var cellButton2= row.insertCell(3);
      cellId.appendChild(document.createTextNode(childKey));
      cellAnnouncement.appendChild(document.createTextNode(childData.Announcement));
      cellButton.appendChild(button);
      cellButton2.appendChild(button2);

      button.onclick = editA;
      button2.onclick = deleteA;
      rowIndex = rowIndex + 1;

    });
  });

  //createNew Announcement Data
  function createNewAnnouncement(){
    var data = $('#Announcement').val();
    var keyA = fbA.push().key;
    var AData = {
      a_id : keyA,
      Announcement: data
    }
    var updates = {};
    updates['Announcements/'+ keyA] = AData;
    firebase.database().ref().update(updates);
    alert('Successfully Entered');
    window.location.reload();
  }

  //Deleting Announcements
  function deleteA(){
    var fbB= firebase.database().ref('Announcements');
    var Ukey = $(this).closest('tr').children('td:first').text();
    console.log(Ukey);
    fbB.child(Ukey).remove();
    alert("successfully deleted!");
    window.location.reload();

  }

  //Editing Announcement
  function editA(){
    document.getElementById('editABlock').style.display ='block';
    var Ukey = $(this).closest('tr').children('td:first').text();
    var fbB= firebase.database().ref('Announcements/'+Ukey);
    fbB.on('value', function(snapshot){
      var EAdata = snapshot.child('Announcement').val();
      console.log(EAdata);
      document.getElementById('Amsg').value = EAdata;
    });
    console.log(Ukey);
    document.getElementById('announcement_id').value = Ukey;
  }

  function editSave(){
    var editedData = $("#Amsg").val();
    var akey = $("#announcement_id").val();
    var wholeA ={
      Announcement: editedData,
      a_id: akey
  }
    var updates={};
    updates['Announcements/'+ akey] = wholeA;
    window.location.reload();
    return firebase.database().ref().update(updates);

  }

   function editCancel(){
    window.location.reload();
  }

  //Event
  var fbE = firebase.database().ref('Events');

  function AddNewEvent(){
      document.getElementById('newEBlock').style.display ='block';
  }

  var eventable = document.getElementById('eventTable');
  var rowIndexE = 1;
  fbE.once('value',function(snapshot){
    snapshot.forEach(function(childSnapshot){
      var childKey = childSnapshot.key;
      var childData = childSnapshot.val();
      var button = document.createElement("button");
      var button2 = document.createElement("button");
      button.innerHTML="Edit";
      button2.innerHTML="Delete";

      var row = eventable.insertRow(rowIndexE);
      var cellId = row.insertCell(0)
      var celleventDate = row.insertCell(1);
      var celleventActivity = row.insertCell(2);
      var cellButton= row.insertCell(3);
      var cellButton2= row.insertCell(4);
      cellId.appendChild(document.createTextNode(childKey));
      celleventDate.appendChild(document.createTextNode(childData.EventDate));
      celleventActivity.appendChild(document.createTextNode(childData.Event));
      cellButton.appendChild(button);
      cellButton2.appendChild(button2);

      button.onclick = editE;
      button2.onclick = deleteE;
      rowIndexE = rowIndexE + 1;

    });
  });

  function createNewEvent(){
    var eventTime=$('#EventTime').val();
    var eventActivity = $('#EventActivity').val();
    var keyA = fbE.push().key;
    var AData = {
      e_id : keyA,
      EventDate : eventTime,
      Event :eventActivity
    }
    var updates = {};
    updates['Events/'+ keyA] = AData;
    firebase.database().ref().update(updates);
    alert('Successfully Entered');
    window.location.reload();
  }

  function editE(){
    document.getElementById('editEBlock').style.display ='block';
    var Ukey = $(this).closest('tr').children('td:first').text();
    var fbE= firebase.database().ref('Events/'+Ukey);
    fbE.on('value', function(snapshot){
      var Doe = snapshot.child('EventDate').val();
      var Edata = snapshot.child('Event').val();
      console.log(Edata);
      console.log(Doe);
      document.getElementById('DoE').value = Doe;
      document.getElementById('Event').value = Edata;
    });
    console.log(Ukey);
    document.getElementById('Ekey').value = Ukey;

  }

  function deleteE(){
    var fbB= firebase.database().ref('Events');
    var Ukey = $(this).closest('tr').children('td:first').text();
    console.log(Ukey);
    fbB.child(Ukey).remove();
    alert("successfully deleted!");
    window.location.reload();

  }

  function editEsave(){
    var editedDOE = $("#DoE").val();
    var editedEText = $("#Event").val();
    var akey = $("#Ekey").val();
    var wholeE ={
      e_id : akey,
      EventDate : editedDOE,
      Event : editedEText
  }
    var updates={};
    updates['Events/'+ akey] = wholeE;
    window.location.reload();
    return firebase.database().ref().update(updates);

  }
</script>


</body>

</html>
